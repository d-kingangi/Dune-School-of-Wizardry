--find the addresses, collections minted, amount earned for the collections minted, 
-- user_address
-- num_collections_minted
-- num_items_in_collection
-- cumulative_minted
-- total_earned_from_collection
-- total_earned_from_all_nfts

WITH earnings_ranked AS (
  SELECT
    seller AS user_address,
    SUM(amount_usd) AS total_earned_from_all_nfts
  FROM rarible.trades
  WHERE
    NOT seller IS NULL
  GROUP BY
    seller
  ORDER BY
    SUM(amount_usd) DESC
  LIMIT 100
)
SELECT
  er.user_address,
  COUNT(DISTINCT rt.collection) AS num_collections_minted,
  COUNT(*) AS num_items_in_collection,
  SUM(COUNT(*)) OVER (PARTITION BY er.user_address) AS cumulative_minted,
  SUM(rt.amount_usd) AS total_earned_from_collection,
  er.total_earned_from_all_nfts
FROM rarible.trades AS rt
JOIN earnings_ranked AS er
  ON rt.seller = er.user_address
GROUP BY
  er.user_address,
  rt.collection,
  er.total_earned_from_all_nfts



user_address
num_collections_minted
num_items_in_collection
cumulative_minted
total_earned_from_collection
total_earned_from_all_nfts

0x62ba79977bcde0ca4e0e045a1a23bbdc1144416c
0
20
20
95180.886114625
95180.886114625
0xd55e219946623fe1707b69db4a541a691e6d46d6
0
100
100
42661.230258399984
42661.230258399984
0x2593b05e88d5fe9dca7409931e11e29267ade0bd
0
8
8
25506.794853299998
25506.794853299998
0x83c84f5991e3f488443fd97af61deee21ddf0104
0
18
18
11756.99465182
11756.99465182
0x310cc5af294f0c0b04defeea5ac4b7398229ce1b
0
1
1
17385.5037
17385.5037
0x7def5be6476fc1c29ab889a48a6a61d876684504
0
3
3
15028.007149999998
15028.007149999998
0xecc0942e31ebdd12366d2a73f69588337ebfe857
0
37
37
19384.499574069996
19384.49957407
0x16116fa82666e9405f27edb264449881df151ce9
0
48
48
112868.377061025
112868.37706102502
0x08cc3fdb02c0c9b823f3a92676de12bd5af0da0e
0
30
30
15043.821632030002
15043.821632030002
0xa528a15203a4c70fb48f18b94aefd0523bac0df5
0
27
27
36715.72841855001
36715.728418549996
0x40a8eee46f349b38d2189974d8cf7fc1e1653b84
0
18
18
17225.05889205
17225.058892050005
0xb0c15e4de976a15be06812de647b04b10939e692
0
17
17
19406.410007019997
19406.41000702
0x1904ae3c764b1abc5f9244175e0b8ed83f817919
0
9
9
44538.067202000006
44538.067202
0x46306796c3f7c477e0575b991bc7957bf372475b
0
11
11
17783.854063000002
17783.854063000002
0x5d1e7a887a9c7d5ec97c0f255e780e2ce756820c
0
42
42
12268.946916950003
12268.94691695
0x80287fa345f90610f59b46b69273993e8f66fb44
0
4
4
17209.0331
17209.0331
0x99b7c019f5e57c0e35c471b61bd664e5bcd10dde
0
11
11
31537.706749920002
31537.70674992
0xa03f6a1f27b93cb706a17b3910c083a9daf3f402
0
450
450
90042.63341171987
90042.63341171997
0xc87830aa9de3f3ada92256ebd5a5fd90dba21717
0
8
8
15333.089830599998
15333.089830599998
0xfb07d6b3bf0f2a9d86a51bef535f091b47119599
0
9
9
35600.565930025
35600.565930025
0xeec418b40433011944afc80b4e16a9c822c52113
0
7
7
12198.78749256
12198.78749256
0x800e6807653e735f83fb305b52cd602ff522aacd
0
108
108
44178.04034073999
44178.04034074
0x6fbe1dc767e178ffe2512560febcd462eeff8036
0
314
314
125998.11850889995
125998.11850889996
0xcda31ef080e99f60573c4d8c426d32b05a44ac4f
0
790
790
50498.90811749504
50498.90811749498
0x0e9ada97ddbbf004c3d8303282d7d14b1cecb7be
0
63
63
79535.62551574997
79535.62551575