WITH
  avg_price AS (
    SELECT
      DATE_TRUNC('day', minute) AS dt,
      AVG(price) AS price
    FROM
      prices.usd
    WHERE
      blockchain = 'base'
      AND contract_address = FROM_HEX('4ed4E862860beD51a9570b96d89aF5E1B0Efefed')
    GROUP BY
      1
    ORDER BY
      dt DESC
  ),
  stats AS (
    SELECT
      DATE_TRUNC('day', evt_block_time) AS dt,
      COUNT(DISTINCT evt_tx_from) AS dau,
      COUNT(*) AS txs
    FROM
      erc20_base.evt_Transfer
    WHERE
      contract_address = FROM_HEX('4ed4E862860beD51a9570b96d89aF5E1B0Efefed')
    GROUP BY
      1
  )
SELECT
  *
FROM
  avg_price
  JOIN stats ON avg_price.dt = stats.dt


  --results

  --dt
--price
--dau
--txs

2024-03-20 00:00
0.005973336805555556
5510
20359
2024-02-23 00:00
0.000877361111111116
1423
4384
2024-03-13 00:00
0.0018198263888888943
765
2158
2024-03-07 00:00
0.002162749999999996
1290
3592
2024-03-15 00:00
0.003815288194444446
3362
23076
2024-03-02 00:00
0.0018315868055555561
2539
6416
2024-01-27 00:00
0.00024368055555555737
228
644
2024-03-05 00:00
0.0027660208333333378
2034
6518
2024-02-04 00:00
0.002982381944444438
3929
19305
2024-03-18 00:00
0.004664048611111143
2175
14539
2024-01-19 00:00
0.00016498611111111084
265
769
2024-03-22 00:00
0.008430659722222249
4332
19789
2024-03-24 00:00
0.010709673611111173
5230
17195
2024-01-17 00:00
0.00008038173611111083
274
756
2024-03-21 00:00
0.00758025694444448
4653
24004
2024-02-07 00:00
0.00402680208333334
2124
13204
2024-01-18 00:00
0.00011114440972222217
199
535
2024-03-10 00:00
0.00202712152777777
997
3126
2024-02-01 00:00
0.0009089166666666696
733
5235
2024-03-23 00:00
0.009024190972222224
3300
12110
2024-01-24 00:00
0.00021268055555555488
192
553
2024-02-06 00:00
0.002232239583333343
1218
5477
2024-02-25 00:00
0.0011572847222222208
634
1809
2024-03-28 00:00
0.018927149305555623
20011
144882
2024-03-04 00:00
0.0022638784722222253
1617
5195