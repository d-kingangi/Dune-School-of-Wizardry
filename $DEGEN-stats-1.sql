WITH
  avg_price AS (
    SELECT
      DATE_TRUNC('day', minute) AS dt,
      AVG(price) AS avg_price
    FROM
      prices.usd
    WHERE
      blockchain = 'base'
      AND contract_address = 0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed
    GROUP BY
      1
    ORDER BY
      dt DESC
  ),
  stats AS (
    SELECT
      DATE_TRUNC('day', evt_block_time) AS dt,
      COUNT(DISTINCT "from") AS daily_active_users,
      COUNT(*) AS total_transactions
    FROM
      erc20_base.evt_Transfer
    WHERE
      contract_address = 0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed
    GROUP BY
      1
  )
SELECT
  dt AS date,
  total_transactions AS total_transactions,
  avg_price AS average_price,
  SUM(total_transactions) OVER (
    ORDER BY
      dt
  ) AS cumulative_transactions
FROM
  stats
  LEFT JOIN avg_price USING (dt)
ORDER BY
  dt DESC



  
--date
--total_transactions
--average_price

cumulative_transactions
2024-04-03 00:00
42084
0.04046416666666667
1703018
2024-04-02 00:00
127924
0.04138721180555551
1660934
2024-04-01 00:00
143303
0.05079904513888895
1533010
2024-03-31 00:00
280458
0.051328000000000144
1389707
2024-03-30 00:00
225989
0.031423048611111136
1109249
2024-03-29 00:00
162160
0.02442712152777783
883260
2024-03-28 00:00
144882
0.018927149305555623
721100
2024-03-27 00:00
23195
0.015859402777777837
576218
2024-03-26 00:00
26244
0.017484170138888578
553023
2024-03-25 00:00
36494
0.016324503472222255
526779
2024-03-24 00:00
17195
0.010709673611111173
490285
2024-03-23 00:00
12110
0.009024190972222224
473090
2024-03-22 00:00
19789
0.008430659722222249
460980
2024-03-21 00:00
24004
0.00758025694444448
441191
2024-03-20 00:00
20359
0.005973336805555556
417187
2024-03-19 00:00
12879
0.0036828402777777792
396828
2024-03-18 00:00
14539
0.004664048611111143
383949
2024-03-17 00:00
15707
0.004891256944444497
369410
2024-03-16 00:00
18657
0.004804579861111112
353703
2024-03-15 00:00
23076
0.003815288194444446
335046
2024-03-14 00:00
32010
0.0030357916666666675
311970
2024-03-13 00:00
2158
0.0018198263888888943
279960
2024-03-12 00:00
2516
0.0017652916666666648
277802
2024-03-11 00:00
2717
0.001981114583333329
275286
2024-03-10 00:00
3126
0.00202712152777777
272569