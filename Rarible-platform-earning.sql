--find the amount the Rarible Marketplace has earned from sales and resales of NFT on the platform
-- transaction_week
-- weekly_platform_earnings_usd
-- cumulative_platform_earnings_usd
-- weekly_platform_earnings_raw
-- cumulative_platform_earnings_raw

WITH weekly_platform_earnings AS (
  SELECT
    DATE_TRUNC('week', block_time) AS transaction_week,
    SUM(platform_fee_amount_usd) AS weekly_platform_earnings_usd,
    SUM(platform_fee_amount_raw) AS weekly_platform_earnings_raw
  FROM rarible.trades
  GROUP BY
    1
  ORDER BY
    transaction_week
), trade_comparison AS (
  SELECT
    block_time,
    platform_fee_amount_usd,
    amount_usd AS trade_earnings_usd,
    seller AS user_address
  FROM rarible.trades
)
SELECT
  wpe.transaction_week,
  wpe.weekly_platform_earnings_usd,
  SUM(wpe.weekly_platform_earnings_usd) OVER (ORDER BY wpe.transaction_week) AS cumulative_platform_earnings_usd,
  wpe.weekly_platform_earnings_raw,
  SUM(wpe.weekly_platform_earnings_raw) OVER (ORDER BY wpe.transaction_week) AS cumulative_platform_earnings_raw
FROM weekly_platform_earnings AS wpe
ORDER BY
  transaction_week


-- transaction_week
-- weekly_platform_earnings_usd
-- cumulative_platform_earnings_usd
-- weekly_platform_earnings_raw
-- cumulative_platform_earnings_raw


2022-02-21 00:00
0.00028431
0.00028431
201000000000000
201000000000000
2022-03-14 00:00
8.7361568725
8.7364411825
5855900750000000000
5856101750000000000
2022-03-21 00:00
74.81767507117249
83.55411625367249
32650735790750000000
38506837540750000000
2022-03-28 00:00
175.92002204139698
259.47413829506945
71465899827106689230
109972737367856689230
2022-04-04 00:00
95.18758753071711
354.66172582578656
55663870152652504000
165636607520509193230
2022-04-11 00:00
230.3342676850492
584.9959935108358
58317175166563191210
223953782687072384440
2022-04-18 00:00
211.96450383562646
796.9604973464623
85580510496578775500
309534293183651159940
2022-04-25 00:00
190.2587246679278
987.2192220143901
100390981049417127730
409925274233068287670
2022-05-02 00:00
189.9582222259001
1177.1774442402902
109694653550794309982
519619927783862597652
2022-05-09 00:00
112.30380771558198
1289.4812519558723
64105504944864152887
583725432728726750539
2022-05-16 00:00
770.4318812436251
2059.913133199497
1032038351364141362061
1615763784092868112600
2022-05-23 00:00
265.25889104464886
2325.172024244146
331655907441756358888
1947419691534624471488
2022-05-30 00:00
338.16872794561914
2663.340752189765
417866775349357770185
2365286466883982241673
2022-06-06 00:00
153.93992000682874
2817.280672196594
152881148311750024167
2518167615195732265840
2022-06-13 00:00
96.93261797373455
2914.2132901703285
183670406971234368223
2701838022166966634063
2022-06-20 00:00
33.89726876439809
2948.1105589347267
24083477735616803658
2725921499902583437721
2022-06-27 00:00
19.932148604471568
2968.042707539198
29366032450996761403
2755287532353580199124
2022-07-04 00:00
81.9334899093706
3049.9761974485687
128004776975482291647
2883292309329062490771
2022-07-11 00:00
182.83807311848673
3232.8142705670552
313122527927173980141
3196414837256236470912
2022-07-18 00:00
20.96143835989615
3253.775708926951
10762089539566910013
3207176926795803380925
2022-07-25 00:00
38.46734148902151
3292.243050415973
13309555745856100292
3220486482541659481217
2022-08-01 00:00
338.50182010680214
3630.7448705227753
307101571350823329380
3527588053892482810597
2022-08-08 00:00
161.43353430750426
3792.1784048302798
32755665899175338997
3560343719791658149594
2022-08-15 00:00
313.2480969920643
4105.426501822344
17442971936837179615
3577786691728495329209
2022-08-22 00:00
91.96275399873745
4197.389255821082
11999746834483031644
3589786438562978360853